å¤ªå¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æ¥ä¸ºä½ å®Œæ•´æ•´ç†ä¸€ä¸ª**ROS 2 Humble + CUDA 12.6 + cuDNN 9.3 + TensorRT 10.3 + PyTorch 2.1 çš„å¤šç”¨æˆ·å¯å…±äº«å¼€å‘ç¯å¢ƒé…ç½®æ–¹æ¡ˆ**ï¼ŒåŸºäº Docker æŠ€æœ¯ï¼Œå®Œå…¨ä»å¤´å¼€å§‹æ­å»ºï¼ŒåŒ…æ‹¬ä¸»æœºç«¯å‡†å¤‡ã€é•œåƒæ„å»ºã€å·¥ä½œåŒºç»„ç»‡ã€å®¹å™¨è¿è¡Œã€æƒé™ç®¡ç†ç­‰ã€‚

---

# âœ… ä¸€ç«™å¼å®‰è£…ä¸é…ç½®æŒ‡å—ï¼ˆå«å¤šç”¨æˆ·æ”¯æŒï¼‰

---

## ğŸ§© **å‰æå‡è®¾ï¼š**
- ä¸»æœºæ“ä½œç³»ç»Ÿä¸ºï¼š**Ubuntu 24.04**
- å·²å®‰è£… NVIDIA GPU é©±åŠ¨ï¼ˆéªŒè¯ `nvidia-smi` æ­£å¸¸å·¥ä½œï¼‰
- ä½¿ç”¨ Dockerï¼ˆé Podmanï¼‰
- æ‰€æœ‰å¼€å‘äººå‘˜éƒ½æœ‰ç‹¬ç«‹ç³»ç»Ÿè´¦æˆ·

---

## âœ… ç¬¬ä¸€æ­¥ï¼šä¸»æœºç¯å¢ƒå‡†å¤‡ï¼ˆåªéœ€åšä¸€æ¬¡ï¼‰

### 1. å®‰è£… Docker & NVIDIA Container Toolkit

```bash
# å®‰è£… Docker
sudo apt update
sudo apt install -y docker.io

# å¯åŠ¨ Docker æœåŠ¡
sudo systemctl enable --now docker

# å®‰è£… NVIDIA Container Toolkit
sudo apt install -y nvidia-container-toolkit
sudo systemctl restart docker
```

### 2. ç»™æ‰€æœ‰ç”¨æˆ·æ·»åŠ  Docker æƒé™

```bash
sudo usermod -aG docker user1
sudo usermod -aG docker user2
```

ç”¨æˆ· **å¿…é¡»æ³¨é”€å†ç™»å½•** æ‰èƒ½ç”Ÿæ•ˆã€‚

---

## âœ… ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå…±äº« ROS 2 å·¥ä½œåŒºç›®å½•ï¼ˆä¸»æœºä¸Šï¼‰

```bash
sudo mkdir -p /opt/ros2_ws/src
sudo chown root:docker /opt/ros2_ws
sudo chmod -R 2775 /opt/ros2_ws
```

è¿™æ · `/opt/ros2_ws` å¯¹æ‰€æœ‰ `docker` ç”¨æˆ·ç»„æˆå‘˜å¯è¯»å†™å…±äº«ï¼Œé€‚åˆå¤šä¸ªç”¨æˆ·åä½œå¼€å‘ã€‚

---

## âœ… ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡ TensorRT å®‰è£…åŒ…

1. ä¸‹è½½åœ°å€ï¼š[NVIDIA TensorRT å®˜ç½‘](https://developer.nvidia.com/nvidia-tensorrt-download)
2. é€‰æ‹© Linux â†’ x86_64 â†’ `.tar.gz` æ ¼å¼ï¼ˆä¾‹å¦‚ `TensorRT-10.3.0.2.Linux.x86_64-gnu.cuda-12.3.tar.gz`ï¼‰
3. ä¸‹è½½åæ”¾åˆ°å’Œ `Dockerfile` ç›¸åŒç›®å½•ä¸‹

---

## âœ… ç¬¬å››æ­¥ï¼šç¼–å†™ Dockerfile

å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º `Dockerfile`ï¼Œä¸ TensorRT å®‰è£…åŒ…åŒç›®å½•ï¼š

```dockerfile
FROM nvidia/cuda:12.6.0-cudnn9-devel-ubuntu22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Etc/UTC
ENV LANG=en_US.UTF-8
ENV LC_ALL=en_US.UTF-8

RUN apt update && apt install -y \
    locales \
    curl \
    gnupg \
    lsb-release \
    sudo \
    git \
    python3-pip \
    python3-colcon-common-extensions \
    python3-rosdep \
    python3-argcomplete \
    python3-vcstool \
    build-essential \
    cmake \
    wget \
    software-properties-common \
    libssl-dev \
    && locale-gen en_US en_US.UTF-8 && update-locale

RUN curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | apt-key add - && \
    echo "deb http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" > /etc/apt/sources.list.d/ros2.list && \
    apt update && apt install -y ros-humble-desktop

RUN rosdep init && rosdep update

RUN pip install --upgrade pip && \
    pip install torch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 --index-url https://download.pytorch.org/whl/cu121

COPY TensorRT-10.3.0.2.Linux.x86_64-gnu.cuda-12.3.tar.gz /tmp/TensorRT.tar.gz
RUN mkdir -p /opt/tensorrt && \
    tar -xzf /tmp/TensorRT.tar.gz -C /opt/tensorrt --strip-components=1 && \
    rm /tmp/TensorRT.tar.gz && \
    cp /opt/tensorrt/include/* /usr/include/ && \
    cp /opt/tensorrt/lib/* /usr/lib/ && \
    ldconfig

WORKDIR /ros2_ws

CMD ["/bin/bash"]
```

---

## âœ… ç¬¬äº”æ­¥ï¼šæ„å»º Docker é•œåƒï¼ˆåœ¨åŒ…å« Dockerfile å’Œ TensorRT æ–‡ä»¶çš„ç›®å½•ä¸­ï¼‰

```bash
docker build -t ros2-humble-dev:cuda12-tensorrt10-pytorch2.1 .
```

æ„å»ºè¿‡ç¨‹ä¼šæ¯”è¾ƒä¹…ï¼ˆ15â€“30åˆ†é’Ÿï¼‰ï¼Œå–å†³äºç½‘ç»œå’Œç¡¬ç›˜ã€‚

---

## âœ… ç¬¬å…­æ­¥ï¼šæ¯ä½å¼€å‘è€…è¿è¡Œå®¹å™¨ï¼ˆå»ºè®®ä½¿ç”¨ç”¨æˆ·è„šæœ¬ï¼‰

ä½ å¯ä»¥æä¾›å¦‚ä¸‹å‘½ä»¤æˆ–è„šæœ¬ç»™æ¯ä½ç”¨æˆ·ï¼š

```bash
docker run -it --gpus all --net=host \
  --name ros2-dev-$(whoami) \
  --user $(id -u):$(id -g) \
  -v /opt/ros2_ws:/ros2_ws \
  ros2-humble-dev:cuda12-tensorrt10-pytorch2.1
```

è¯´æ˜ï¼š
- `--user` ä¿è¯å®¹å™¨ä¸­ç”Ÿæˆçš„æ–‡ä»¶å±ä¸»æ˜¯å½“å‰ç”¨æˆ·ï¼›
- `--gpus all` å¯ç”¨ GPUï¼›
- `--net=host` è®© ROS èŠ‚ç‚¹é€šä¿¡ä¸å—å®¹å™¨ç½‘ç»œéš”ç¦»å½±å“ï¼›
- `-v /opt/ros2_ws:/ros2_ws` æ˜ å°„å…±äº«å·¥ä½œåŒºã€‚

---

## âœ… ç¬¬ä¸ƒæ­¥ï¼šåœ¨å®¹å™¨å†…åˆå§‹åŒ–å¹¶ç¼–è¯‘ä»£ç ï¼ˆåªéœ€åšä¸€æ¬¡ï¼‰

```bash
source /opt/ros/humble/setup.bash
cd /ros2_ws
mkdir -p src
rosdep install --from-paths src --ignore-src -r -y
colcon build --symlink-install
```

---

## âœ… é™„åŠ å»ºè®®

| åŠŸèƒ½ | å»ºè®® |
|------|------|
| å›¾å½¢è°ƒè¯•å·¥å…·ï¼ˆå¦‚ `rviz2`ï¼‰ | æ·»åŠ  `-e DISPLAY=$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix` å¯åŠ¨å®¹å™¨æ—¶æ”¯æŒ |
| VSCode è°ƒè¯• | ä½¿ç”¨ [Remote - Containers æ’ä»¶](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) æ‰“å¼€å®¹å™¨å¼€å‘ |
| å¤šäººä»£ç ç®¡ç† | ä½¿ç”¨ Git ç®¡ç† `/opt/ros2_ws/src`ï¼Œå¤šäººåä½œå¼€å‘ç»Ÿä¸€ä»£ç åº“ |
| å¤šä¸ªå®¹å™¨äº’ä¸å¹²æ‰° | æ¯ä¸ªç”¨æˆ·èµ·ä¸åŒå®¹å™¨å `--name ros2-dev-<username>` å³å¯ |

---

## âœ… éœ€è¦æˆ‘ä¸ºä½ é™„åŠ æä¾›ï¼š

- [`run_ros2_dev.sh`] è‡ªåŠ¨å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨è„šæœ¬ï¼Ÿ
- [`docker-compose.yml`] å¤šèŠ‚ç‚¹ååŒå®¹å™¨ï¼Ÿ
- [`devcontainer.json`] ç›´æ¥ VSCode æ‰“å¼€å®¹å™¨é¡¹ç›®è°ƒè¯•ï¼Ÿ

å‘Šè¯‰æˆ‘ä½ æ›´æƒ³è¦å“ªä¸ªï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥å¸®ä½ ç”Ÿæˆï¼
