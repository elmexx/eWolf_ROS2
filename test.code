#!/bin/bash
CONTAINER_NAME="ros2-dev"
IMAGE_NAME="osrf/ros:humble-desktop-full"

# Check if container exists
if [ "$(docker ps -a -q -f name=^/${CONTAINER_NAME}$)" ]; then
    echo "Starting existing ROS 2 container..."
    docker start -ai ${CONTAINER_NAME}
else
    echo "Creating new ROS 2 container..."
    docker run -it \
        --name ${CONTAINER_NAME} \
        -e DISPLAY=$DISPLAY \
        -e QT_X11_NO_MITSHM=1 \
        -v /tmp/.X11-unix:/tmp/.X11-unix \
        -v ~/ros2_ws:/root/ros2_ws \
        ${IMAGE_NAME} \
        bash
fi


#!/bin/bash
CONTAINER_NAME="ros1-dev"
IMAGE_NAME="osrf/ros:noetic-desktop-full"

# Check if container exists
if [ "$(docker ps -a -q -f name=^/${CONTAINER_NAME}$)" ]; then
    echo "Starting existing ROS 1 container..."
    docker start -ai ${CONTAINER_NAME}
else
    echo "Creating new ROS 1 container..."
    docker run -it \
        --name ${CONTAINER_NAME} \
        -e DISPLAY=$DISPLAY \
        -e QT_X11_NO_MITSHM=1 \
        -v /tmp/.X11-unix:/tmp/.X11-unix \
        -v ~/ros_ws:/root/ros_ws \
        ${IMAGE_NAME} \
        bash
fi


chmod +x ~/docker_ros_env/run_ros1.sh
chmod +x ~/docker_ros_env/run_ros2.sh

echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc
echo "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc

echo "source /opt/ros/noetic/setup.bash" >> ~/.bashrc
echo "source ~/ros_ws/devel/setup.bash" >> ~/.bashrc


docker start -ai ros2-dev
docker commit ros2-dev ros2-dev-checkpoint:v1


å¾ˆå¥½ï¼ŒåŸºäºä½ ä¸»æœºçš„ç”¨æˆ·ä¿¡æ¯ï¼š

* ç”¨æˆ·åï¼š`fmon005`
* UIDï¼š`1000`
* GIDï¼š`1000`

æˆ‘ä¸ºä½ ç”Ÿæˆäº†ä¸€ä¸ª**é•¿æœŸå¼€å‘ç”¨çš„ ROS 2 Humble Docker é•œåƒ Dockerfile**ï¼Œå®ƒï¼š

* âœ… åŸºäº `osrf/ros:humble-desktop-full`
* âœ… åˆ›å»º `fmon005` ç”¨æˆ·ï¼ˆUID/GID ä¸å®¿ä¸»ä¸€è‡´ï¼‰
* âœ… é…ç½® GUI æ”¯æŒï¼ˆ`rviz`ã€`rqt`ï¼‰
* âœ… é»˜è®¤ä½¿ç”¨è¯¥ç”¨æˆ·è¿›å…¥å®¹å™¨ï¼Œé¿å… root æƒé™æ±¡æŸ“ä¸»æœºæ–‡ä»¶
* âœ… é€‚åˆé•¿æœŸå¼€å‘ï¼Œå¯ `apt install` è½¯ä»¶åæŒä¹…ä½¿ç”¨ï¼ˆå®¹å™¨ä¸åŠ  `--rm`ï¼‰

---

## âœ… æ­¥éª¤ä¸€ï¼šå‡†å¤‡ Dockerfileï¼ˆROS 2ï¼‰

ä¿å­˜ä¸ºï¼š`~/docker_ros_env/Dockerfile_ros2`

```dockerfile
FROM osrf/ros:humble-desktop-full

# æ·»åŠ é root ç”¨æˆ·ï¼Œä¸å®¿ä¸»ä¸€è‡´ï¼ˆç”¨æˆ·åã€UIDã€GIDï¼‰
ARG USERNAME=fmon005
ARG USER_UID=1000
ARG USER_GID=1000

RUN groupadd -g ${USER_GID} ${USERNAME} && \
    useradd -m -u ${USER_UID} -g ${USER_GID} -s /bin/bash ${USERNAME} && \
    echo "${USERNAME} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# è®¾ç½®é»˜è®¤ç”¨æˆ·å’Œå·¥ä½œç›®å½•
USER ${USERNAME}
WORKDIR /home/${USERNAME}

# ä¿è¯ source ROS ç¯å¢ƒ
RUN echo "source /opt/ros/humble/setup.bash" >> /home/${USERNAME}/.bashrc

# GUI æ”¯æŒå˜é‡
ENV QT_X11_NO_MITSHM=1
```

---

## âœ… æ­¥éª¤äºŒï¼šæ„å»ºè‡ªå®šä¹‰é•œåƒ

åœ¨ `~/docker_ros_env/` ä¸‹æ‰§è¡Œï¼š

```bash
docker build -f Dockerfile_ros2 -t ros2-dev-user .
```

---

## âœ… æ­¥éª¤ä¸‰ï¼šæ›´æ–° run è„šæœ¬ï¼ˆ`run_ros2.sh`ï¼‰

ä¿å­˜ä¸ºï¼š`~/docker_ros_env/run_ros2.sh`

```bash
#!/bin/bash

CONTAINER_NAME="ros2-dev"
IMAGE_NAME="ros2-dev-user"

docker ps -a --format '{{.Names}}' | grep -q "^${CONTAINER_NAME}$"

if [ $? -eq 0 ]; then
    echo "Starting existing container '${CONTAINER_NAME}'..."
    docker start -ai ${CONTAINER_NAME}
else
    echo "Creating new container '${CONTAINER_NAME}'..."
    docker run -it \
        --name ${CONTAINER_NAME} \
        -e DISPLAY=$DISPLAY \
        -v /tmp/.X11-unix:/tmp/.X11-unix \
        -v ~/ros2_ws:/home/fmon005/ros2_ws \
        ${IMAGE_NAME} \
        bash
fi
```

---

## âœ… èµ‹äºˆæ‰§è¡Œæƒé™

```bash
chmod +x ~/docker_ros_env/run_ros2.sh
```

---

## âœ… ç°åœ¨ä½ å¯ä»¥è¿™æ ·å¼€å‘ï¼š

1. å¯åŠ¨å¼€å‘å®¹å™¨ï¼š

   ```bash
   ~/docker_ros_env/run_ros2.sh
   ```

2. åœ¨å®¹å™¨ä¸­ç»§ç»­å¼€å‘ï¼ˆå¦‚å¹³æ—¶ä¸€æ ·ï¼‰ï¼š

   ```bash
   cd ~/ros2_ws
   colcon build
   ros2 run ...
   ```

3. å®‰è£…åŒ…ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ï¼š

   ```bash
   sudo apt update
   sudo apt install ros-humble-navigation2
   ```

è¿™äº›å˜æ›´éƒ½ä¼šåœ¨å®¹å™¨ä¸­ä¿ç•™ã€‚

---

å¦‚æœä½ ä¹Ÿå¸Œæœ›æˆ‘ç”Ÿæˆ ROS 1 çš„ç‰ˆæœ¬ï¼ˆNoeticï¼‰â€” `Dockerfile_ros1` + `run_ros1.sh` â€” ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ å¯¹ç§°é…ç½®ã€‚éœ€è¦å—ï¼Ÿ



å¥½çš„ï¼Œä»¥ä¸‹æ˜¯ä¸ä½ å½“å‰ä¸»æœºä¸€è‡´çš„ **ROS 1 Noetic Docker å¼€å‘ç¯å¢ƒé…ç½®**ï¼ŒåŒ…å«ï¼š

* âœ… Dockerfileï¼ˆåŸºäº `osrf/ros:noetic-desktop-full`ï¼‰
* âœ… åˆ›å»ºç”¨æˆ· `fmon005`ï¼ŒUID/GID = 1000
* âœ… æ”¯æŒ `rviz`ã€GUI
* âœ… è‡ªåŠ¨ `source` ROS ç¯å¢ƒ
* âœ… é…å¥— `run_ros1.sh` å¯åŠ¨è„šæœ¬ï¼Œæ”¯æŒé¦–æ¬¡åˆ›å»ºå’Œåç»­å¯åŠ¨
* âœ… å®¿ä¸»ç›®å½• `~/ros_ws` æŒ‚è½½åˆ°å®¹å™¨å†… `/home/fmon005/ros_ws`ï¼Œé€‚åˆé•¿æœŸå¼€å‘

---

## ğŸ“„ æ­¥éª¤ä¸€ï¼šä¿å­˜ Dockerfileï¼ˆROS 1ï¼‰

è·¯å¾„ï¼š`~/docker_ros_env/Dockerfile_ros1`

```dockerfile
FROM osrf/ros:noetic-desktop-full

ARG USERNAME=fmon005
ARG USER_UID=1000
ARG USER_GID=1000

# åˆ›å»ºç”¨æˆ·å¹¶é…ç½® sudo æƒé™
RUN groupadd -g ${USER_GID} ${USERNAME} && \
    useradd -m -u ${USER_UID} -g ${USER_GID} -s /bin/bash ${USERNAME} && \
    echo "${USERNAME} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

USER ${USERNAME}
WORKDIR /home/${USERNAME}

# é»˜è®¤åŠ è½½ ROS ç¯å¢ƒ
RUN echo "source /opt/ros/noetic/setup.bash" >> /home/${USERNAME}/.bashrc

ENV QT_X11_NO_MITSHM=1
```

---

## ğŸ›  æ­¥éª¤äºŒï¼šæ„å»ºé•œåƒ

åœ¨ `~/docker_ros_env` ä¸­è¿è¡Œï¼š

```bash
docker build -f Dockerfile_ros1 -t ros1-dev-user .
```

---

## ğŸš€ æ­¥éª¤ä¸‰ï¼šä¿å­˜å¯åŠ¨è„šæœ¬ `run_ros1.sh`

è·¯å¾„ï¼š`~/docker_ros_env/run_ros1.sh`

```bash
#!/bin/bash

CONTAINER_NAME="ros1-dev"
IMAGE_NAME="ros1-dev-user"

docker ps -a --format '{{.Names}}' | grep -q "^${CONTAINER_NAME}$"

if [ $? -eq 0 ]; then
    echo "Starting existing container '${CONTAINER_NAME}'..."
    docker start -ai ${CONTAINER_NAME}
else
    echo "Creating new container '${CONTAINER_NAME}'..."
    docker run -it \
        --name ${CONTAINER_NAME} \
        -e DISPLAY=$DISPLAY \
        -v /tmp/.X11-unix:/tmp/.X11-unix \
        -v ~/ros_ws:/home/fmon005/ros_ws \
        ${IMAGE_NAME} \
        bash
fi
```

---

## âœ… æ­¥éª¤å››ï¼šèµ‹äºˆæ‰§è¡Œæƒé™

```bash
chmod +x ~/docker_ros_env/run_ros1.sh
```

---

## ğŸ§ª ä½¿ç”¨æ–¹å¼

* å¯åŠ¨ ROS 1 å¼€å‘å®¹å™¨ï¼š

  ```bash
  ~/docker_ros_env/run_ros1.sh
  ```

* åœ¨å®¹å™¨ä¸­è¿›è¡Œ ROS 1 å¼€å‘ï¼š

  ```bash
  cd ~/ros_ws
  catkin_make
  rosrun ...
  ```

* å®‰è£…æ–°åŒ…ï¼ˆé•¿æœŸæœ‰æ•ˆï¼‰ï¼š

  ```bash
  sudo apt install ros-noetic-navigation
  ```

---

## âœ… æœ€ç»ˆç»“æœ

ä½ ç°åœ¨æ‹¥æœ‰ä¸¤ä¸ªç‹¬ç«‹ã€æŒä¹…ã€å®‰å…¨çš„å¼€å‘ç¯å¢ƒï¼š

| å¼€å‘ç¯å¢ƒ  | å¯åŠ¨è„šæœ¬          | é•œåƒå             | ç”¨æˆ·        | æŒ‚è½½è·¯å¾„                                  |
| ----- | ------------- | --------------- | --------- | ------------------------------------- |
| ROS 1 | `run_ros1.sh` | `ros1-dev-user` | `fmon005` | `~/ros_ws` â†’ `/home/fmon005/ros_ws`   |
| ROS 2 | `run_ros2.sh` | `ros2-dev-user` | `fmon005` | `~/ros2_ws` â†’ `/home/fmon005/ros2_ws` |

å¦‚æœä½ ä»¥åè¿˜æƒ³æ·»åŠ ï¼š

* å¤šå®¹å™¨é€šä¿¡ï¼ˆbridge/network hostï¼‰
* ROS + VSCode devcontainer
* æ•°æ®é›†æˆ–è®¾å¤‡æŒ‚è½½ï¼ˆå¦‚ bag æ–‡ä»¶ã€USB ç›¸æœºï¼‰

ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ç»§ç»­å¸®ä½ æ‰©å±•è¿™å¥—ä½“ç³»ã€‚

